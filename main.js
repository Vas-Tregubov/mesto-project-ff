(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-19",headers:{authorization:"a8fbcde7-37e5-4c27-96cb-428c4a4c4a64","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},r=function(r,n){var o=n?"PUT":"DELETE";return fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:o,headers:e.headers}).then(t)},n="e5f96a8c118edfdc88d8f400",o=document.querySelector("#card-template").content;function c(e,t,c,a){var u=o.querySelector(".card").cloneNode("true");u.querySelector(".card__image").src=e.link,u.querySelector(".card__image").alt=e.name,u.querySelector(".card__title").textContent=e.name;var i,s=u.querySelector(".card__delete-button");(i=e.ownerId)&&i!=n&&(s.style.display="none");var l=u.querySelector(".card__like-button");e.isLiked&&l.classList.add("card__like-button_is-active");var d=u.querySelector(".card__like-count");return l.addEventListener("click",(function(t){var n=c(t,e.cardId);!function(e,t,n){var o=parseInt(e.textContent,10);o=t?o+1:o-1,e.textContent=o,r(n,t).catch((function(r){console.error("Ошибка обновления лайков на сервере: ".concat(r)),e.textContent=t?o-1:o+1}))}(d,n,e.cardId)})),d.textContent=e.likeCount,u.querySelector(".card__image").addEventListener("click",a),s.addEventListener("click",(function(r){return t(r,e.cardId)})),u}function a(r,n){r.target.closest(".card").remove(),function(r){fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(t)}(n)}function u(e,t){var n=e.target.closest(".card__like-button");n.classList.toggle("card__like-button_is-active");var o=n.classList.contains("card__like-button_is-active");return r(t,o),o}function i(e){e.classList.add("popup_is-opened"),e.querySelector(".popup__close").addEventListener("click",d),document.addEventListener("keydown",l),window.addEventListener("click",s)}function s(e){var t=document.querySelector(".popup_is-opened");e.target===t&&p(t)}function l(e){"Escape"===e.key&&p(document.querySelector(".popup_is-opened"))}function d(){p(document.querySelector(".popup_is-opened"))}function p(e){e.classList.remove("popup_is-opened"),e.querySelector(".popup__close").removeEventListener("click",d),window.removeEventListener("click",s),document.removeEventListener("keydown",l)}var _={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"};function f(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}function m(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(r.inactiveButtonClass)):(t.disabled=!0,t.classList.add(r.inactiveButtonClass))}function y(e){Array.from(e.querySelectorAll(".popup__input")).forEach((function(t){f(e,t,_)}))}var v=document.querySelector(".places__list"),h=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),b=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-avatar"),E=document.querySelector(".popup__input_type_avatar_url"),g=document.querySelector(".popup__input_type_name"),C=document.querySelector(".popup__input_type_description");b.addEventListener("click",(function(){i(k),B(k),y(k)})),q.addEventListener("click",(function(){i(L),B(L),y(L)}));var w=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup__input_type_card-name"),I=document.querySelector(".popup__input_type_url");document.querySelector(".profile__add-button").addEventListener("click",(function(){i(w),B(w),y(w)}));var A=document.querySelector(".popup_type_image"),T=A.querySelector(".popup__image"),U=A.querySelector(".popup__caption");function N(e){var t=e.target.closest(".card__image"),r=t.src,n=t.alt;T.src=r,T.alt=n,U.textContent=n,i(A)}document.forms["edit-profile"].addEventListener("submit",(function(r){r.preventDefault(),function(r,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:n})}).then(t)}(g.value,C.value).then((function(e){h.textContent=e.name,S.textContent=e.about,q.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.error("Ошибка обновления профиля: ".concat(e))})),p(r.target.closest(".popup"))}));var D=document.forms["new-place"];function B(e){e.querySelectorAll("input, textarea, select").forEach((function(e){"input"!==e.tagName.toLowerCase()||"text"!==e.type&&"textarea"!==e.type&&"number"!==e.type&&"email"!==e.type&&"url"!==e.type?("textarea"===e.tagName.toLowerCase()||"select"===e.tagName.toLowerCase())&&(e.value=e.defaultValue):e.value=e.defaultValue})),m(Array.from(e.querySelectorAll(".popup__input")),e.querySelector(".popup__button"),_)}D.addEventListener("submit",(function(r){r.preventDefault(),function(r,n){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:n})}).then(t)}(x.value,I.value).then((function(e){var t;t={name:e.name,link:e.link,likeCount:e.likes.length,ownerId:e.owner._id,cardId:e._id},v.prepend(c(t,a,u,N)),p(r.target.closest(".popup")),B(D)})).catch((function(e){console.error("Ошибка добавления карточки: ".concat(e))}))})),document.forms["new-avatar"].addEventListener("submit",(function(r){r.preventDefault(),function(r){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then(t)}(E.value).then((function(e){q.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.error("Ошибка обновления аватара: ".concat(e))})),p(r.target.closest(".popup"))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);m(r,n,t),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,o,t),m(r,n,t)}))}))}(t,e)}))}(_),h&&S&&q?fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then(t).then((function(e){h.textContent=e.name,S.textContent=e.about,q.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.error(e)})):console.error("Ошибка: Не удалось найти элементы DOM"),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then(t).then((function(e){e.forEach((function(e){var t={name:e.name,link:e.link,likeCount:e.likes.length,ownerId:e.owner._id,cardId:e._id,isLiked:e.likes.some((function(e){return e._id===n}))};v.append(c(t,a,u,N))}))}))})();